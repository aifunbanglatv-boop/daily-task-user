<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Daily Task Pro</title>
    
    <!-- Core SDKs -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">

    <style>
        :root { --bg:#0f172a; --card:rgba(30,41,59,0.95); --text:#f1f5f9; --primary:#6366f1; --success:#10b981; --danger:#ef4444; --warning:#f59e0b; }
        body { margin:0; background:var(--bg); color:var(--text); font-family:'Inter',sans-serif; display:flex; flex-direction:column; align-items:center; min-height:100vh; padding-bottom:90px; -webkit-tap-highlight-color: transparent; overflow-x: hidden; }
        .con { width:100%; max-width:480px; padding:20px; box-sizing: border-box; }
        .glass-card { background:var(--card); border:1px solid rgba(255,255,255,0.1); border-radius:20px; padding:20px; margin-bottom:15px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); }
        .balance-amount { font-size:38px; font-weight:800; background:linear-gradient(to right,#fff,#86efac); -webkit-background-clip:text; -webkit-text-fill-color:transparent; }
        .header-top { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; width: 100%; }
        .v-badge { background:rgba(16,185,129,0.15); color:#10b981; padding:6px 12px; border-radius:20px; font-size:12px; border:1px solid rgba(16,185,129,0.3); font-weight:700; display:flex; align-items:center; gap:5px; }
        
        .action-btn { width:100%; padding:16px; border-radius:14px; border:none; font-weight:700; color:white; cursor:pointer; margin-bottom:10px; font-size:16px; transition:0.2s; display:flex; align-items:center; justify-content:center; gap:8px; }
        .btn-primary { background:var(--primary); box-shadow: 0 4px 15px rgba(99,102,241,0.3); }
        .btn-success { background:var(--success); }
        .btn-danger { background:var(--danger); }
        .action-btn:active { transform: scale(0.98); }
        .action-btn:disabled { opacity:0.5; cursor: not-allowed; }

        /* GRID LAYOUT FOR TASKS */
        .task-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-top: 10px; }
        .task-item { background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 16px; padding: 20px 10px; text-align: center; cursor: pointer; transition: 0.2s; display: flex; flex-direction: column; align-items: center; gap: 10px; }
        .task-item:active { transform: scale(0.96); background: rgba(255,255,255,0.1); }
        .task-icon { width: 50px; height: 50px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 24px; color: white; margin-bottom: 5px; box-shadow: 0 5px 15px rgba(0,0,0,0.3); }
        
        /* Gradients for Icons */
        .g-1 { background: linear-gradient(135deg, #6366f1, #8b5cf6); }
        .g-2 { background: linear-gradient(135deg, #f59e0b, #d97706); }
        .g-3 { background: linear-gradient(135deg, #10b981, #059669); }
        .g-4 { background: linear-gradient(135deg, #ef4444, #b91c1c); }
        .g-5 { background: linear-gradient(135deg, #ec4899, #db2777); }
        .g-6 { background: linear-gradient(135deg, #06b6d4, #0891b2); }

        .prog-track { width: 100%; height: 10px; background: rgba(255,255,255,0.1); border-radius: 10px; overflow: hidden; margin: 15px 0; }
        .prog-fill { height: 100%; background: var(--primary); width: 0%; transition: 0.5s; }

        .navbar { position:fixed; bottom:20px; width:90%; max-width:400px; background:rgba(30,41,59,0.95); padding:12px 0; border-radius:20px; display:flex; justify-content:space-around; border:1px solid #334155; z-index:100; backdrop-filter: blur(10px); box-shadow: 0 10px 40px rgba(0,0,0,0.5); }
        .nav-item { background:none; border:none; color:#64748b; font-size:22px; cursor:pointer; display: flex; flex-direction: column; align-items: center; gap: 4px; text-decoration: none; transition: 0.2s; }
        .nav-item span { font-size: 10px; font-weight: 600; }
        .nav-item.active { color:#10b981; transform: translateY(-2px); }

        .view { display:none; animation: fadeIn 0.3s ease; } .view.active { display:block; }
        .toast { position:fixed; top:20px; left:50%; transform:translateX(-50%); background:#0f172a; padding:12px 24px; border-radius:12px; border:1px solid #334155; display:none; z-index:2000; font-weight:bold; text-align:center; box-shadow: 0 5px 20px rgba(0,0,0,0.5); }
        
        #timer-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(15, 23, 42, 0.98); z-index: 99999; display: none; flex-direction: column; align-items: center; justify-content: center; backdrop-filter: blur(10px); }
        .timer-circle { width: 140px; height: 140px; border-radius: 50%; border: 6px solid var(--primary); display: flex; align-items: center; justify-content: center; font-size: 55px; font-weight: bold; color: white; margin-bottom: 20px; box-shadow: 0 0 40px rgba(99, 102, 241, 0.5); }
        
        /* Task Details Page */
        #task-detail { text-align: center; }
        .back-btn { background: none; border: none; color: #94a3b8; font-size: 16px; cursor: pointer; margin-right: auto; display: block; margin-bottom: 15px; }
        
        .pay-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin-bottom: 15px; }
        .pay-opt { background: rgba(255,255,255,0.05); padding: 15px 10px; border-radius: 10px; text-align: center; border: 1px solid transparent; cursor: pointer; transition: 0.2s; display:flex; flex-direction:column; align-items:center; gap:5px; }
        .pay-opt.active { border-color: #10b981; background: rgba(16,185,129,0.1); color: #10b981; }
        .pay-opt img { width: 35px; height: 35px; border-radius: 50%; object-fit: cover; margin-bottom: 5px; }
        .custom-input, .custom-select { width: 100%; padding: 14px; background: rgba(0,0,0,0.3); border: 1px solid #334155; border-radius: 12px; color: white; margin-bottom: 10px; font-size: 15px; box-sizing: border-box; }
        .history-item { background: rgba(255,255,255,0.05); padding: 10px; border-radius: 10px; margin-bottom: 10px; display: flex; flex-direction: column; gap: 5px; cursor: pointer; }
    </style>
</head>
<body>

    <div id="block-screen" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #020617; z-index: 9999; display: none; flex-direction: column; align-items: center; justify-content: center; text-align: center; padding: 20px;">
        <div class="glass-card" style="border-color: var(--danger);">
            <i class="fas fa-user-slash" style="font-size: 50px; color: var(--danger); margin-bottom: 20px;"></i>
            <h2 style="margin-top:0;">Account Suspended</h2>
            <p id="block-reason">Multiple accounts not allowed.</p>
        </div>
    </div>

    <div id="timer-overlay">
        <div class="timer-circle" id="overlayCount">15</div>
        <div class="timer-text" style="color:white; font-weight:bold; font-size:20px; text-align:center; line-height:1.5;">Watching Ad...<br><span style="font-size:14px; color:#94a3b8;">Wait for reward</span></div>
    </div>

    <div id="toast" class="toast"></div>

    <div class="con">
        <div class="header-top">
            <div style="display:flex; align-items:center; gap:12px;">
                <div style="width:40px; height:40px; background:var(--success); border-radius:10px; display:flex; align-items:center; justify-content:center; font-weight:bold; color: white;" id="uAv">U</div>
                <div>
                    <h3 style="margin:0; font-size:16px;" id="uName">Guest</h3>
                    <span style="font-size:12px; color:#94a3b8;" id="uId">ID: Loading...</span>
                </div>
            </div>
            <div class="v-badge"><i class="fas fa-shield-alt"></i> Verified</div>
        </div>

        <!-- HOME VIEW -->
        <div id="home" class="view active">
            <div class="glass-card">
                <div style="color:#94a3b8; font-size:13px;">Current Balance</div>
                <div class="balance-amount">৳ <span id="balanceDisplay">0.00</span></div>
            </div>
            
            <h4 style="margin: 15px 0 10px 0;">Available Tasks</h4>
            
            <!-- 2x3 GRID FOR 6 NETWORKS -->
            <div class="task-grid">
                <div class="task-item" onclick="openTaskView(1)">
                    <div class="task-icon g-1"><i class="fas fa-play"></i></div>
                    <span style="font-weight:bold;">Silver Task</span>
                    <span style="font-size:10px; color:#94a3b8;">Monetag Ads</span>
                </div>
                <div class="task-item" onclick="openTaskView(2)">
                    <div class="task-icon g-2"><i class="fas fa-star"></i></div>
                    <span style="font-weight:bold;">Gold Task</span>
                    <span style="font-size:10px; color:#94a3b8;">Direct Ads 1</span>
                </div>
                <div class="task-item" onclick="openTaskView(3)">
                    <div class="task-icon g-3"><i class="fas fa-gem"></i></div>
                    <span style="font-weight:bold;">Diamond Task</span>
                    <span style="font-size:10px; color:#94a3b8;">Direct Ads 2</span>
                </div>
                <div class="task-item" onclick="openTaskView(4)">
                    <div class="task-icon g-4"><i class="fas fa-crown"></i></div>
                    <span style="font-weight:bold;">Platinum Task</span>
                    <span style="font-size:10px; color:#94a3b8;">Direct Ads 3</span>
                </div>
                <div class="task-item" onclick="openTaskView(5)">
                    <div class="task-icon g-5"><i class="fas fa-bolt"></i></div>
                    <span style="font-weight:bold;">Premium Task</span>
                    <span style="font-size:10px; color:#94a3b8;">Direct Ads 4</span>
                </div>
                <div class="task-item" onclick="openTaskView(6)">
                    <div class="task-icon g-6"><i class="fas fa-fire"></i></div>
                    <span style="font-weight:bold;">Ultra Task</span>
                    <span style="font-size:10px; color:#94a3b8;">Direct Ads 5</span>
                </div>
            </div>

            <div class="social-grid">
                <a href="#" id="tgBtn" target="_blank" class="social-card"><i class="fab fa-telegram" style="color:#229ED9;"></i><span>Channel</span></a>
                <a href="#" id="ytBtn" target="_blank" class="social-card"><i class="fab fa-youtube" style="color:#FF0000;"></i><span>Tutorial</span></a>
            </div>
        </div>

        <!-- INDIVIDUAL TASK VIEW (HIDDEN INITIALLY) -->
        <div id="task-detail" class="view">
            <button class="back-btn" onclick="backToHome()"><i class="fas fa-arrow-left"></i> Back</button>
            
            <div class="glass-card">
                <div class="task-icon g-1" id="detailIcon" style="margin: 0 auto 10px auto; width: 60px; height: 60px; font-size: 28px;">
                    <i class="fas fa-play" id="detailIconI"></i>
                </div>
                <h3 id="detailTitle">Task Name</h3>
                <p style="font-size:12px; color:#94a3b8; margin-bottom: 20px;">Watch ads to earn rewards. Do not use VPN.</p>
                
                <div style="margin-top:10px;">
                    <div style="display:flex; justify-content:space-between; font-size:12px; color:#94a3b8;"><span>Today's Progress</span><span id="progText">0/0</span></div>
                    <div class="prog-track"><div class="prog-fill" id="progFill"></div></div>
                </div>

                <button class="action-btn btn-primary" id="watchAdBtn" onclick="executeAd()" style="margin-top: 20px;">Watch Ad</button>
            </div>
        </div>

        <!-- WALLET -->
        <div id="pay" class="view">
            <div class="glass-card">
                <h3>Withdrawal</h3>
                <div id="loadingMethods" style="text-align:center; color:#94a3b8; font-size:12px;">Loading Methods...</div>
                <div class="pay-grid" id="payGrid"></div>
                <div id="operatorBox" style="display:none;"><select id="operator" class="custom-select"><option value="Grameenphone">Grameenphone</option><option value="Banglalink">Banglalink</option><option value="Robi">Robi</option><option value="Airtel">Airtel</option><option value="Teletalk">Teletalk</option></select></div>
                <div id="feeInfo" style="text-align:center; font-size:12px; color:#94a3b8; margin-bottom:10px;"></div>
                <input type="number" id="wAmount" class="custom-input" placeholder="Amount (BDT)" oninput="calcTotal()">
                <div id="totalDeduct" style="font-size:12px; color:white; margin-bottom:10px; text-align:right;">Total: ৳0.00</div>
                <input type="text" id="wAccount" class="custom-input" placeholder="Wallet / ID">
                <div id="usdtConversion" style="display:none; text-align:right; font-size:12px; color:#10b981; margin-bottom:15px; font-weight:bold;">≈ 0.00 USD</div>
                <button class="action-btn btn-success" id="confirmWithdrawBtn" onclick="submitWithdraw()">Withdraw</button>
            </div>
            <div class="glass-card"><h4>History</h4><div id="historyList"></div></div>
        </div>

        <!-- TEAM -->
        <div id="ref" class="view">
            <div class="glass-card" style="text-align:center">
                <h3>Refer & Earn</h3>
                <p>Refer Bonus: <span id="refBonusText" style="color:#10b981; font-weight:bold;">0</span></p>
                <div id="refLink" style="background:rgba(0,0,0,0.3); padding:10px; border-radius:12px; font-size:11px; word-break:break-all; border:1px dashed #334155; color:#10b981;">Loading...</div>
                <button class="action-btn btn-primary" onclick="copyRef()" style="margin-top:10px;">Copy Link</button>
            </div>
            <div class="glass-card"><h4>My Team</h4><div id="team"></div></div>
        </div>
    </div>

    <div class="navbar">
        <button class="nav-item active" onclick="switchView('home', this)"><i class="fas fa-home"></i><span>Home</span></button>
        <button class="nav-item" onclick="switchView('pay', this)"><i class="fas fa-wallet"></i><span>Wallet</span></button>
        <button class="nav-item" onclick="switchView('ref', this)"><i class="fas fa-users"></i><span>Team</span></button>
    </div>

    <script>
        // BUYER: PASTE YOUR FIREBASE CONFIG HERE
        const firebaseConfig = {
            apiKey: "PASTE_API_KEY_HERE",
            authDomain: "PASTE_AUTH_DOMAIN_HERE",
            databaseURL: "PASTE_DATABASE_URL_HERE",
            projectId: "PASTE_PROJECT_ID_HERE",
            storageBucket: "PASTE_STORAGE_BUCKET_HERE",
            messagingSenderId: "PASTE_MESSAGING_SENDER_ID_HERE",
            appId: "PASTE_APP_ID_HERE"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        const tg = window.Telegram.WebApp;

        let state = { id: null, balance: 0, today: 0, activeTask: 1, taskRunning: false };
        let SETTINGS = {};
        let methods = []; let selectedMethod = null;

        function init() {
            try { tg.ready(); tg.expand(); } catch(e){}
            state.id = tg.initDataUnsafe.user ? tg.initDataUnsafe.user.id.toString() : (localStorage.getItem('app_user_uid') || Math.floor(100000 + Math.random() * 900000).toString());
            localStorage.setItem('app_user_uid', state.id);
            const uName = tg.initDataUnsafe.user ? tg.initDataUnsafe.user.first_name : 'Guest';
            checkDeviceLock(uName);
        }

        // ... [DEVICE LOCK LOGIC SAME AS BEFORE] ...
        function getDeviceFingerprint() {
            const str = navigator.userAgent + screen.width + "x" + screen.height + (new Date().getTimezoneOffset());
            let hash = 0; for (let i = 0; i < str.length; i++) { hash = ((hash << 5) - hash) + str.charCodeAt(i); hash = hash & hash; }
            return Math.abs(hash).toString(16);
        }
        function checkDeviceLock(uName) {
            const deviceId = getDeviceFingerprint();
            db.ref('device_locks/' + deviceId).once('value', snap => {
                if(snap.exists() && snap.val() !== state.id) {
                    document.getElementById('block-screen').style.display = 'flex';
                } else {
                    db.ref('device_locks/' + deviceId).set(state.id);
                    document.getElementById('uName').innerText = uName;
                    document.getElementById('uAv').innerText = uName[0].toUpperCase();
                    document.getElementById('uId').innerText = 'ID: ' + state.id;
                    syncUser(uName); loadSettings(); loadHistory(); loadTeam();
                }
            });
        }

        function syncUser(n) {
            db.ref('users/' + state.id).on('value', snap => {
                const data = snap.val();
                const todayStr = new Date().toISOString().split('T')[0];
                if(data) {
                    if(data.blocked) { document.getElementById('block-screen').style.display='flex'; document.getElementById('block-reason').innerText=data.blockReason; return; }
                    if(data.lastDate !== todayStr) { db.ref('users/' + state.id).update({ todayCount: 0, lastDate: todayStr }); return; }
                    state.balance = data.balance || 0; state.today = data.todayCount || 0;
                    document.getElementById('balanceDisplay').innerText = (state.balance / 100).toFixed(2);
                    const limit = SETTINGS.adLimit || 50;
                    document.getElementById('progText').innerText = `${state.today}/${limit}`;
                    document.getElementById('progFill').style.width = (state.today / limit * 100) + '%';
                } else {
                    db.ref('users/' + state.id).set({ name: n, balance: 0, todayCount: 0, lastDate: todayStr, blocked: false });
                }
            });
        }

        function loadSettings() {
            db.ref('settings').on('value', snap => {
                if(snap.exists()) {
                    SETTINGS = snap.val();
                    document.getElementById('refBonusText').innerText = (SETTINGS.refB || 0);
                    if(SETTINGS.botUser) document.getElementById('refLink').innerText = `https://t.me/${SETTINGS.botUser}?start=ref_${state.id}`;
                    if(SETTINGS.tgLink) document.getElementById('tgBtn').href = SETTINGS.tgLink;
                    if(SETTINGS.ytLink) document.getElementById('ytBtn').href = SETTINGS.ytLink;
                    
                    // MONETAG SCRIPT INJECTION (Only if Net1 selected)
                    if(SETTINGS.monetag_id && !document.getElementById('monetag-script')) {
                        const script = document.createElement('script'); script.id = 'monetag-script'; script.src = '//libtl.com/sdk.js'; script.setAttribute('data-zone', SETTINGS.monetag_id); script.setAttribute('data-sdk', 'show_' + SETTINGS.monetag_id); document.head.appendChild(script);
                    }
                }
            });
            // ... [Payment Methods Load Logic Same as Before] ...
            db.ref('settings/methods').on('value', snap => {
                const grid = document.getElementById('payGrid'); grid.innerHTML = ''; methods = [];
                document.getElementById('loadingMethods').style.display = 'none';
                if(snap.exists()){
                    snap.forEach(c => {
                        const m = { key: c.key, ...c.val() }; methods.push(m);
                        grid.innerHTML += `<div class="pay-opt" onclick="selPay('${m.key}', this)"><img src="${m.icon}" onerror="this.src='https://cdn-icons-png.flaticon.com/512/25/25228.png'"><span style="font-size:11px; font-weight:bold;">${m.name}</span></div>`;
                    });
                }
            });
        }

        // --- GRID NAVIGATION & AD LOGIC ---
        
        function openTaskView(netId) {
            state.activeTask = netId;
            const titles = ["Silver Task", "Gold Task", "Diamond Task", "Platinum Task", "Premium Task", "Ultra Task"];
            const icons = ["fa-play", "fa-star", "fa-gem", "fa-crown", "fa-bolt", "fa-fire"];
            
            document.getElementById('home').classList.remove('active');
            document.getElementById('task-detail').classList.add('active');
            
            document.getElementById('detailTitle').innerText = titles[netId - 1];
            document.getElementById('detailIcon').className = `task-icon g-${netId}`;
            document.getElementById('detailIconI').className = `fas ${icons[netId - 1]}`;
        }

        function backToHome() {
            document.getElementById('task-detail').classList.remove('active');
            document.getElementById('home').classList.add('active');
        }

        function executeAd() {
            if(state.taskRunning) return;
            const btn = document.getElementById('watchAdBtn');
            btn.disabled = true; btn.innerText = "Loading...";

            // 1. Monetag (Script)
            if(state.activeTask === 1) {
                const zoneId = SETTINGS.monetag_id;
                const adFunction = window['show_' + zoneId];
                if(typeof adFunction === 'function') {
                    adFunction().then(() => {
                        startTimer();
                    }).catch(e => {
                        startTimer(); // Fallback if ad fails/blocks
                    });
                } else {
                    startTimer(); // Fallback
                }
            } 
            // 2-6. Direct Links (Adsterra, AdMaven, etc.)
            else {
                let link = "";
                if(state.activeTask === 2) link = SETTINGS.net2_link;
                else if(state.activeTask === 3) link = SETTINGS.net3_link;
                else if(state.activeTask === 4) link = SETTINGS.net4_link;
                else if(state.activeTask === 5) link = SETTINGS.net5_link;
                else if(state.activeTask === 6) link = SETTINGS.net6_link;

                if(link) {
                    window.open(link, '_blank');
                    startTimer();
                } else {
                    alert("Ad link not configured by admin!");
                    btn.disabled = false; btn.innerText = "Watch Ad";
                }
            }
        }

        function startTimer() {
            state.taskRunning = true;
            document.getElementById('timer-overlay').style.display = 'flex';
            let t = 15;
            const timer = setInterval(() => {
                t--;
                document.getElementById('overlayCount').innerText = t;
                if(t <= 0) {
                    clearInterval(timer);
                    document.getElementById('timer-overlay').style.display = 'none';
                    state.taskRunning = false;
                    document.getElementById('watchAdBtn').disabled = false;
                    document.getElementById('watchAdBtn').innerText = "Watch Ad";
                    addReward(SETTINGS.adReward || 10);
                }
            }, 1000);
        }

        function addReward(amt) {
            db.ref('users/' + state.id).transaction(u => {
                if(u) { u.balance = (u.balance || 0) + amt; u.todayCount = (u.todayCount || 0) + 1; }
                return u;
            });
        }

        function switchView(v, el) { 
            document.querySelectorAll('.view').forEach(e => e.classList.remove('active')); 
            document.getElementById(v).classList.add('active'); 
            if(el) { document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active')); el.classList.add('active'); }
        }

        // ... [COPY PAY AND WITHDRAW LOGIC FROM PREVIOUS SCRIPTS - KEEPING IT CONCISE HERE] ...
        function selPay(key, el) { selectedMethod = methods.find(m => m.key === key); document.querySelectorAll('.pay-opt').forEach(e => e.classList.remove('active')); el.classList.add('active'); const opBox = document.getElementById('operatorBox'); const accInput = document.getElementById('wAccount'); const usdtDiv = document.getElementById('usdtConversion'); if (selectedMethod.type === 'recharge') { opBox.style.display = 'block'; accInput.placeholder = "Enter Mobile Number"; usdtDiv.style.display = 'none'; } else if (selectedMethod.type === 'address') { opBox.style.display = 'none'; accInput.placeholder = "Enter Wallet Address / ID"; usdtDiv.style.display = 'block'; calcTotal(); } else { opBox.style.display = 'none'; accInput.placeholder = "Enter Personal Wallet Number"; usdtDiv.style.display = 'none'; } const fee = selectedMethod.fee || 0; document.getElementById('feeInfo').innerText = `Fee: ৳${fee} | Min: ৳${selectedMethod.min}`; calcTotal(); }
        function calcTotal() { const amount = parseInt(document.getElementById('wAmount').value) || 0; if(!selectedMethod) return; const fee = selectedMethod.fee || 0; const total = amount + fee; document.getElementById('totalDeduct').innerText = `Total: ৳${total}`; if(selectedMethod.type === 'address' || selectedMethod.name.toUpperCase().includes('USDT')) { const rate = SETTINGS.usdtRate || 120; const usdVal = (amount / rate).toFixed(2); document.getElementById('usdtConversion').style.display = 'block'; document.getElementById('usdtConversion').innerText = `≈ $${usdVal} USD (Rate: 1$ = ${rate} BDT)`; } else { document.getElementById('usdtConversion').style.display = 'none'; } }
        function submitWithdraw() { if(!selectedMethod) return alert("Select method"); const amount = parseInt(document.getElementById('wAmount').value); const account = document.getElementById('wAccount').value; const op = document.getElementById('operator').value; if(!amount || amount < selectedMethod.min) return alert("Invalid amount"); const fee = selectedMethod.fee || 0; const totalDeduct = (amount + fee) * 100; if(state.balance < totalDeduct) return alert("Low balance"); const wData = { userId: state.id.toString(), amount: amount, fee: fee, method: selectedMethod.name, account: account, operator: selectedMethod.type === 'recharge' ? op : null, status: 'pending', date: Date.now() }; db.ref('users/' + state.id).transaction(u => { if(u && u.balance >= totalDeduct) { u.balance -= totalDeduct; return u; } }); db.ref('withdrawals').push(wData); alert("Submitted!"); document.getElementById('wAmount').value = ''; updateUI(); }
        function loadHistory() { db.ref('withdrawals').limitToLast(50).on('value', snap => { const list = document.getElementById('historyList'); list.innerHTML = ''; const arr = []; snap.forEach(c => { if(c.val().userId == state.id) arr.push(c.val()); }); arr.reverse().forEach(d => { let color = d.status==='paid'?'#10b981':d.status==='pending'?'#f59e0b':'#ef4444'; list.innerHTML += `<div class="history-item" style="border-left:4px solid ${color}"><div style="display:flex; justify-content:space-between;"><span style="color:white; font-weight:bold;">৳${d.amount}</span><span style="color:${color}">${d.status.toUpperCase()}</span></div><small style="color:#94a3b8">${d.method} - ${d.account}</small></div>`; }); }); }
        function copyRef() { navigator.clipboard.writeText(document.getElementById('refLink').innerText); alert("Copied!"); }
        function loadTeam() { db.ref('referrals/'+state.id).on('value', snap => { const list = document.getElementById('team'); list.innerHTML = ''; snap.forEach(c => { list.innerHTML += `<div class="history-item"><span>${c.val().name}</span></div>`; }); }); }

        init();
    </script>
</body>
</html>
